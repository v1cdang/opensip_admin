<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

class CalleridController extends Controller
{
    public function index($prefix, $ipaddress)
    {

        $callerid = '';
        /*
        if ($prefix=='3300') {
            $available_callerids['CA'] = '13236419245';
            $available_callerids['CO'] = '13034810082';
            $available_callerids['CT'] = '18604125025';
            $available_callerids['FL'] = '19042484331';
            $available_callerids['IL'] = '13128210893';
            $available_callerids['MA'] = '16175318167';
            $available_callerids['NJ'] = '19738491638';
            $available_callerids['NM'] = '15053539918';
            $available_callerids['NV'] = '17252060624';
            $available_callerids['TX'] = '19723672084';
            $available_callerids['UT'] = '18016566113';
            $npanxx = substr($phonenumber, 1, 6);
            $state = DB::table('npanxx')->select('stateISO')->where(['npanxx'=>$npanxx])->first();
            if (array_key_exists($state->stateISO, $available_callerids)) {
                $callerid = $available_callerids[$state->stateISO];
                if ($callerid!='')
                    echo $callerid;
                else
                    echo '13236419245';
            } else {
                echo '13236419245';
            }
        } else {
        */

            $available_callerids = [
                '1748651184',
                '7756841700',
                '18563792200',
                '6332891285',
                '3027988161',
                '8775544797',
                '6174378414',
                '6109090309',
                '18333468448',
                '8172494040',
                '9253878242',
                '7034180813',
                '7184264271',
                '3867552233',
                '3524782057',
                '7132438050',
                '9254398575',
                '8168422514',
                '7034815722',
                '9546012121',
                '7142881790',
                '9104334681',
                '2567731768',
                '2814953500',
                '3176366664',
                '9034551010',
                '9403655762',
                '4176231883',
                '2123020552',
                '8634207563',
                '2134833736',
                '7187787901',
                '2122266111',
                '9727318032',
                '3129702881',
                '2053870572',
                '4048928468',
                '3215677500',
                '9106400900',
                '4156685202',
                '9194711534',
                '2522930255',
                '2122444285',
                '7182973745',
                '3862943777',
                '9173698688',
                '9183335217',
                '9183414938',
                '7049342048',
                '2099419632',
                '2814592740',
                '2159720909',
                '8132599911',
                '7858321112',
                '9727751180',
                '8573504646',
                '5122855552',
                '2102289483',
                '5034743466',
                '5034753460',
                '7184039112',
                '8175318880',
                '6173380128',
                '2126770214',
                '2122800582',
                '6152952301',
                '2027379525',
                '5124742380',
                '2563558465',
                '4326853092',
                '8179262661',
                '5598919823',
                '7139825565',
                '2013229090',
                '7184560100',
                '6469187225',
                '4109626520',
                '7137417900',
                '5302291519',
                '3154227144',
                '5124774654',
                '6469684000',
                '3232953194',
                '6616312837',
                '3055945984',
                '2026280720',
                '7048644590',
                '4326892901',
                '5592443700',
                '2563525779',
                '2569745291',
                '7277990910',
                '7048295681',
                '3129384091',
                '9182469570',
                '3869356905',
                '2143392352',
                '2122335023',
                '18667432273',
                '7147752000',
                '2166210132',
                '6178767868',
                '2056474440',
                '2133530552',
                '5102611984',
                '7184841500',
                '2567394601',
                '4078780910',
                '9167401600',
                '2563322869',
                '2392618610',
                '445678765431',
                '2567758778',
                '8602449424',
                '9406264889',
                '9725521634',
                '9187495438',
                '6173544420',
                '7138078491',
                '862831185271',
                '3055326189',
                '9727326197',
                '9182722376',
                '2054869202',
                '8669785002',
                '1310258745',
                '19042451611',
                '18025847589',
                '5012131618',
                '18025847589',
                '18669787299',
                '8889777300',
                '8008168509',
                '3238671611',
                '3127210269',
                '3145850495',
                '17547573646',
                '7065012157',
                '7172328686',
            ];


            $callerids = DB::table('callerids')->select('callerid')->where(['prefix'=>$prefix, 'ip'=>$ipaddress])->inRandomOrder()->get();
            if ($callerids->isNotEmpty()) {
                echo $callerids[0]->callerid;
            } else {
                $callerid = $available_callerids[array_rand($available_callerids,1)];
                echo $callerid;
            }
       // }
    }
}
